params {
	outdir_base = "results"
	outdir_vcfs = "${params.outdir_base}/vcfs"
	outdir_chunked_vcfs = "${params.outdir_base}/chunked_vcfs"
	outdir_pheno_cov = "${params.outdir_base}/pheno_cov"
}

// Profile-specific configurations
profiles {
    hpc {
        singularity {
            enabled = true
            autoMounts = true
        }
    }
    gcp {
        process {
            executor = 'google-batch'
            // Disabling publish to save resources by avoid duplicate outputs in bucket
            publishDir = [enabled: false]
        }

        workDir = 'gs://test-datasets-gwas-prod-results-bucket/work'

        google {
            project = 'test-datasets-gwas'
            location = 'us-central1'
            batch.spot = true
        }

        process {
            errorStrategy = { task.exitStatus==50001 ? 'retry' : 'terminate' }
            maxRetries = 5
        }
    }

    test {
        docker {
            enabled = true
            runOptions = '-u $(id -u):$(id -g)'
        }
        
        // Optional: Add resource limits for CI
        process {
            cpus = 2
            memory = 6.GB
            time = 4.h
        }
    }
}